<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/bootstrap-icons-1.11.3/font/bootstrap-icons.css">
    <link rel="stylesheet" href="/css/fontawesome-free-6.7.1/css/all.css" rel="stylesheet"><!-- icon: fa-->
    <link rel="stylesheet" href="/css/bootstrap5.min.css">
    <link rel="stylesheet" href="/carasol/owl.carousel.min.css">
    <title>會員登入</title>
</head>
<style>

</style>

<body>
    <div class="mt-5 d-flex justify-content-center">
        <div class="row border rounded-2" style="width: 30%;">
            <div class="col-12 text-center">
                <h1>會員登入</h1>
            </div>
            <div class="col-12">
                <label for="" class="form-label">帳號</label>
                <input id="username" name="username" type="text" class="form-control" placeholder="請輸入帳號">
            </div>
            <div class="col-12">
                <label for="" class="form-label">密碼</label>
                <input id="password" name="password" type="password" class="form-control" placeholder="請輸入密碼">
            </div>
            <div class="col-2 mt-3 mb-3">
                <a href="javascript:void(0)" class="btn btn-primary" onclick="login()">登入</a>

            </div>
            <div class="col-2 mt-3 mb-3">
                <a href="javascript:void(0)" class="btn btn-danger">註冊</a>
            </div>
        </div>
    </div>



    <script src="/js/bootstrap5.bundle.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/carasol/owl.carousel.min.js"></script>
    <script src="/js/jquery.elevatezoom.min.js"></script><!--局部放大套件-->
    <script>
       function login(){
        // 先檢查輸入值
        const username = $("#username").val().trim();
        const password = $("#password").val().trim();
        
        // 驗證輸入
        if (!username) {
            alert("請輸入帳號");
            return;
        }
        if (!password) {
            alert("請輸入密碼");
            return;
        }
        
        console.log("準備發送登入請求");
        console.log("帳號:", username);
        console.log("API URL:", "http://localhost:8000/users/login/");
        
        const loginData = {
            username: username,
            password: password
        };
        
        console.log("發送資料:", loginData);
         
        $.ajax({
          url: "http://localhost:8000/users/login/",// 後端驗證 API
          type: "POST",
          dataType: "json",         
          data: JSON.stringify(loginData),
          contentType: "application/json; charset=utf-8",
          timeout: 10000, // 10秒超時
          beforeSend: function() {
              console.log("正在發送請求...");
          },
          success: function(response, textStatus, xhr) {
            console.log("請求成功!");
            console.log("HTTP狀態碼:", xhr.status);
            console.log("完整回應:", response);
            console.log("回應類型:", typeof response);
            
            // 檢查不同可能的成功回應格式
            if (response.success === "200" || 
                response.success === 200 || 
                response.status === 200 ||
                response.code === 200 ||
                xhr.status === 200) {
                
                const username = response.data ? response.data.username : "";
                alert("登入成功！" + username);
                console.log("登入成功，準備跳轉");
                //window.location.href = "home.html";
            } else {
                console.log("登入失敗 - 狀態不正確");
                alert("登入失敗：" + (response.message || response.msg || response.error || "帳號或密碼錯誤"));
            }
          },
          error: function(xhr, status, error) {
            console.log("AJAX請求失敗!");
            console.log("HTTP狀態碼:", xhr.status);
            console.log("狀態文字:", status);
            console.log("錯誤訊息:", error);
            console.log("完整錯誤回應:", xhr.responseText);
            
            let errorMessage = "系統錯誤：";
            
            if (xhr.status === 0) {
                errorMessage += "無法連接到伺服器，請檢查網路連線或伺服器是否啟動";
            } else if (xhr.status === 404) {
                errorMessage += "API路徑不存在 (404)";
            } else if (xhr.status === 500) {
                errorMessage += "伺服器內部錯誤 (500)";
            } else if (xhr.status === 400) {
                errorMessage += "請求參數錯誤 (400)";
            } else if (status === "timeout") {
                errorMessage += "請求超時，請稍後再試";
            } else {
                errorMessage += error + " (狀態碼: " + xhr.status + ")";
            }
            
            // 嘗試解析錯誤回應中的訊息
            try {
                const errorResponse = JSON.parse(xhr.responseText);
                if (errorResponse.message || errorResponse.error) {
                    errorMessage += "\n詳細: " + (errorResponse.message || errorResponse.error);
                }
            } catch (e) {
                // 無法解析JSON，忽略
            }
            
            alert(errorMessage);
          }
        });
       }
       

    </script>

</body>

</html>





